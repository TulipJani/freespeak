<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shared Entry - Freespeak</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Lora:ital,wght@0,400;0,700;1,400&family=Inconsolata:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        .font-system { font-family: system-ui, -apple-system, sans-serif; }
        .font-inter { font-family: 'Inter', sans-serif; }
        .font-lora { font-family: 'Lora', serif; }
        .font-inconsolata { font-family: 'Inconsolata', monospace; }
    </style>
</head>
<body class="min-h-screen bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">
    <div id="app" class="min-h-screen flex flex-col items-center justify-center px-4">
        <div class="w-full max-w-3xl">
            <div class="text-xs mb-2 text-gray-400 text-center">Read-only shared entry</div>
            <div id="content" class="whitespace-pre-wrap leading-relaxed text-lg p-4 rounded bg-gray-50 dark:bg-gray-800 shadow"></div>
        </div>
    </div>

    <script>
        async function loadSharedContent() {
            const pathParts = window.location.pathname.split('/');
            const id = pathParts[pathParts.length - 1];
            
            if (!id) {
                showError('Invalid share link.');
                return;
            }

            try {
                // Initialize Supabase client
                const supabaseUrl = 'YOUR_SUPABASE_URL'; // Replace with your Supabase URL
                const supabaseKey = 'YOUR_SUPABASE_ANON_KEY'; // Replace with your anon key
                const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

                // Fetch data from Supabase
                const { data, error } = await supabase
                    .from('shares')
                    .select('content, font, theme')
                    .eq('id', id)
                    .single();
                
                if (error || !data) {
                    showError('This shared link has expired or does not exist.');
                    return;
                }

                if (!data.content) {
                    showError('No content found.');
                    return;
                }

                // Apply theme
                const body = document.body;
                if (data.theme === 'dark') {
                    body.classList.add('dark');
                } else {
                    body.classList.remove('dark');
                }

                // Apply font
                const contentDiv = document.getElementById('content');
                const fontClass = getFontClass(data.font);
                contentDiv.className = `whitespace-pre-wrap leading-relaxed text-lg p-4 rounded bg-gray-50 dark:bg-gray-800 shadow ${fontClass}`;
                contentDiv.textContent = data.content;

            } catch (error) {
                console.error('Error loading shared content:', error);
                showError('Failed to load shared content.');
            }
        }

        function getFontClass(fontName) {
            const fontMap = {
                'System': 'font-system',
                'Inter': 'font-inter', 
                'Lora': 'font-lora',
                'Inconsolata': 'font-inconsolata'
            };
            return fontMap[fontName] || 'font-system';
        }

        function showError(message) {
            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="text-center">
                    <div class="text-red-500 text-lg mb-4">${message}</div>
                    <a href="/" class="text-blue-500 hover:text-blue-700 underline">Return to Freespeak</a>
                </div>
            `;
        }

        // Load content when page loads
        loadSharedContent();
    </script>
</body>
</html> 